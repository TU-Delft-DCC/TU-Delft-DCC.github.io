

<!DOCTYPE html>


<html >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Setting up a Gitlab runner for MATLAB &#8212; DCC Guides</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script src="../../_static/tabs.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'infrastructure/gitlab/runner_matlab';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Getting started" href="../../data/getting_started.html" />
    <link rel="prev" title="Continuous Integration with Gitlab" href="gitlab_docker.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../welcome.html">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">‚öôÔ∏è Computing infrastructure</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting started</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../intro_servers.html">Remote servers</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../VPS_request.html">Request a Virtual Private Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../VPS_SSH.html">Configure SSH Tunneling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../moving_data.html">Moving data to your server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../VPS_SSL_Certs.html">Configure SSL certificates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apache_webserver.html">Setting up an Apache web server</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="gitlab_intro.html">TU Delft GitLab</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="gitlab_groups.html">Creating GitLab groups</a></li>
<li class="toctree-l2"><a class="reference internal" href="gitlab_transfer_ownership.html">Transfer ownership of a GitLab repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="gitlab_docker.html">Continuous Integration with Gitlab</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Setting up a Gitlab runner for MATLAB</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">üóÉÔ∏è Data management</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../data/getting_started.html">Getting started</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../data/fair.html">FAIR data</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../data/publishing.html">Prepare data for publishing</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../data/storage_options.html">TU Delft data storage</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../data/project_drive_request.html">Request Project Drive space</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../data/project_drive_mounting.html">Mount Project Drive on Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../data/sync_unison.html">Sync with Project Drive and SURFDrive with Unison</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">üíª Research software</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../software/getting_started.html">Getting started</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../software/fair.html">FAIR Software</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../software/checklist.html">FAIR checklist for research software</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../software/project_cards.html">FAIR assessment cards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../software/software_management_plan.html">Software management plan</a></li>
<li class="toctree-l2"><a class="reference external" href="https://tu-delft-dcc.github.io/FAIR4RS/">FAIR for Research Software Program Spring 2023</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../software/testing_intro.html">Software testing</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../software/testing_matlab.html">Testing with MATLAB</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../software/git/intro.html">Version control with Git</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../software/git/branch_management.html">Branch management</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../software/containers/intro.html">Working with containers</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../software/containers/docker_gui.html">Using a docker container with a GUI</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">üìñ Resources</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../resources/courses.html">Courses and workshops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../resources/curriculum.html">Research Software Curriculum</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../resources/tools.html">Tools</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">ü§ù Community</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../community/dcc.html">About the DCC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community/contribute.html">Contributing guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community/code_of_conduct.html">Code of Conduct</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/TU-Delft-DCC/TU-Delft-DCC.github.io" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/TU-Delft-DCC/TU-Delft-DCC.github.io/edit/master/docs/infrastructure/gitlab/runner_matlab.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/infrastructure/gitlab/runner_matlab.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Setting up a Gitlab runner for MATLAB</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#purpose-of-this-guide">Purpose of this guide</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites">Prerequisites</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#glossary-of-terms">Glossary of terms</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#steps">Steps</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-request-a-tu-delft-vps">Step 1. Request a TU Delft VPS</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-setting-up-gitlab-runners">Step 2. Setting up Gitlab runners</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-create-a-docker-image-containing-a-custom-matlab-installation">Step 3. Create a Docker image containing a custom Matlab installation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-register-the-matlab-runner">Step 4. Register the Matlab runner</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-5-obtain-a-matlab-license-file">Step 5. Obtain a Matlab license file</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-6-configure-the-ci-cd-pipeline-on-gitlab">Step 6. Configure the CI/CD pipeline on Gitlab</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-7-add-a-job-to-test-the-pipeline">Step 7. Add a job to test the pipeline</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-8-optional-updating-the-matlab-version">Step 8. Optional: Updating the Matlab version</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="setting-up-a-gitlab-runner-for-matlab">
<h1>Setting up a Gitlab runner for MATLAB<a class="headerlink" href="#setting-up-a-gitlab-runner-for-matlab" title="Permalink to this headline">#</a></h1>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">#</a></h2>
<p>With the continuous method of software development, you continuously build, test, and deploy iterative code changes. This iterative process helps reduce the chance that you develop new code based on buggy or failed previous versions. With this method, you strive to have less human intervention or even no intervention at all, from the development of new code until its deployment.</p>
<section id="purpose-of-this-guide">
<h3>Purpose of this guide<a class="headerlink" href="#purpose-of-this-guide" title="Permalink to this headline">#</a></h3>
<p>With this guide, you will create a Continuous Integration Pipeline on a repository within the <a class="reference external" href="https://gitlab.tudelft.nl">TU Delft Gitlab</a> to use a Matlab environment.</p>
</section>
</section>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">#</a></h2>
<ul>
<li><p>TU Delft netID</p></li>
<li><p>Matlab account</p></li>
<li><p>Basic knowledge of Linux (for setting up a server)</p></li>
<li><p>Basic knowledge of Docker (for creating a custom Matlab image)</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>To learn more about Docker containers, please look at the <a class="reference external" href="https://carpentries-incubator.github.io/docker-introduction/">Reproducible Computational Environments Using Docker lesson</a> from the Software Carpentries.</p>
</div>
</li>
</ul>
</section>
<section id="glossary-of-terms">
<h2>Glossary of terms<a class="headerlink" href="#glossary-of-terms" title="Permalink to this headline">#</a></h2>
<p><strong>CI/CD pipeline</strong><br />
<em>A CI/CD pipeline automates your software delivery process. The pipeline builds code, runs tests (Continuous Intergation), and safely deploys a new version of the application (Continuous Delivery). See this <a class="reference external" href="https://semaphoreci.com/blog/cicd-pipeline">introduction</a>.</em></p>
<p><strong>Docker</strong><br />
<em>We use a Docker container to run the Gitlab runner and initialise the CI/CD pipeline.</em></p>
<p><strong>Gitlab runner</strong> (from GitLab documentation)<br />
<em>Runners are the agents that run the CI/CD jobs that come from GitLab. When you register a runner, you are setting up communication between your GitLab instance and the machine where GitLab Runner is installed. Runners usually process jobs on the same machine where you installed GitLab Runner.</em></p>
<p><strong>Gitlab jobs</strong><br />
<em>Pipeline configuration begins with jobs. Jobs are the most fundamental element of a <code class="docutils literal notranslate"><span class="pre">.gitlab-ci.yml</span></code> file. Each job is executed by a Gitlab runner. See Gitlab documentation for more <a class="reference external" href="https://docs.gitlab.com/ee/ci/jobs/">info</a>.</em></p>
</section>
<section id="steps">
<h2>Steps<a class="headerlink" href="#steps" title="Permalink to this headline">#</a></h2>
<ol class="arabic simple">
<li><p>Request a TU Delft Virtual Private Server</p></li>
<li><p>Set up a Gitlab runner</p></li>
<li><p>Create a Docker image with a custom Matlab installation</p></li>
<li><p>Register a gitlab runner for the Matlab container</p></li>
<li><p>Obtain a Matlab license file</p></li>
<li><p>Configure the CI/CD pipeline</p></li>
<li><p>Add a job to test the pipeline</p></li>
<li><p>Optional: Updating the Matlab version</p></li>
</ol>
<section id="step-1-request-a-tu-delft-vps">
<h3>Step 1. Request a TU Delft VPS<a class="headerlink" href="#step-1-request-a-tu-delft-vps" title="Permalink to this headline">#</a></h3>
<p>If you want to work with the TU Delft Gitlab instance and you want to implement CI/CD pipelines, then you need to install a Gitlab runner on your own. Runners are the agents that run the CI/CD jobs that come from GitLab. Currently, the TU Delft instance does not provide this feature out-of-the-box. Therefore, we need a separate (virtual) server to run the Gitlab runners and execute the jobs in the CI/CD pipeline.</p>
<p>The TU Delft offers Virtual Private Servers (VPS) for researchers through the <a class="reference external" href="https://tudelft.topdesk.net/tas/public/ssp/content/serviceflow?unid=418c986f186d4934848dc2712039ed34">TopDesk selfservice portal</a>. If you don‚Äôt have a VPS already, please follow this guide to <a class="reference external" href="https://tu-delft-dcc.github.io/infrastructure/VPS_request.html">request a Virtual Private Server</a></p>
<p><strong>VPS requirements</strong></p>
<ul class="simple">
<li><p>50Gb disk space (the Matlab installation in this guide requires ~10 Gb, but this depends on the size of the installed addons)</p></li>
</ul>
</section>
<section id="step-2-setting-up-gitlab-runners">
<h3>Step 2. Setting up Gitlab runners<a class="headerlink" href="#step-2-setting-up-gitlab-runners" title="Permalink to this headline">#</a></h3>
<p>To set up a gitlab runner on the VPS, please follow this <a class="reference external" href="https://tu-delft-dcc.github.io/infrastructure/gitlab/gitlab_docker.html">guide for setting up GitLab runners</a>.</p>
<p><strong>TLDR</strong></p>
<ol class="arabic">
<li><p>Install docker with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>docker.io
</pre></div>
</div>
</li>
<li><p>Verify installation with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span>--version
</pre></div>
</div>
</li>
<li><p><em>Optional: Move default storage location to larger drive</em><br />
If the file space in the Docker Root directory is not adequate, we must relocate the Docker Root. Please consult this <a class="reference external" href="https://www.ibm.com/docs/en/z-logdata-analytics/5.1.0?topic=compose-relocating-docker-root-directory">guide for instructions</a>.</p></li>
<li><p>Deploy the gitlab-runner with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>gitlab-runner<span class="w"> </span>--restart<span class="w"> </span>always<span class="w"> </span><span class="se">\</span>
-v<span class="w"> </span>/srv/gitlab-runner/config:/etc/gitlab-runner<span class="w"> </span><span class="se">\</span>
-v<span class="w"> </span>/var/run/docker.sock:/var/run/docker.sock<span class="w"> </span><span class="se">\</span>
gitlab/gitlab-runner:latest
</pre></div>
</div>
</li>
<li><p>Verify deployment with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span>ps<span class="w"> </span>-a
</pre></div>
</div>
</li>
</ol>
</section>
<section id="step-3-create-a-docker-image-containing-a-custom-matlab-installation">
<h3>Step 3. Create a Docker image containing a custom Matlab installation<a class="headerlink" href="#step-3-create-a-docker-image-containing-a-custom-matlab-installation" title="Permalink to this headline">#</a></h3>
<p>In order for a Gitlab runner to execute Matlab code, it needs to be able to access a container with Matlab installed. The aim of this step is to create a Docker image with Matlab installation that can be used by a Gitlab runner. By building our own Docker image, we can specify the Matlab version and customize the installed toolboxes.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We have looked into using the Docker images developed by <a class="reference external" href="https://hub.docker.com/r/mathworks">Mathworks</a>. When running these images, you are prompted to supply your Matlab‚Äôs account username and password to activate the instance. Although it is possible to create a new image from such an activated container and use it on the VPS, we have so far not been able to get this solution working with Gitlab runners. We thus rely on downloading a license file (step 6) and storing it as a Variable on Gitlab (step 7).</p>
</div>
<p>This Dockerfile is based on Matlab‚Äôs <a class="reference external" href="https://github.com/mathworks-ref-arch/matlab-dockerfile">Dockerfile template</a>. We will make the following modifications to this template:</p>
<ul class="simple">
<li><p>set <code class="docutils literal notranslate"><span class="pre">bash</span></code> as the default run command (Gitlab runners need to access a shell)</p></li>
<li><p>add additional Matlab products with the flag <code class="docutils literal notranslate"><span class="pre">--products</span></code>. In this example, we have added the Parallel Computing Toolbox and the Mapping Toolbox.</p></li>
</ul>
<p>In your user folder on the VPS (/home/username), create a file called <code class="docutils literal notranslate"><span class="pre">Dockerfile</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>nano<span class="w"> </span>Dockerfile
</pre></div>
</div>
<p>and copy the content below in the Dockerfile. Make sure to update the Matlab release and installed addons to your requirements (see highlights).</p>
<div class="highlight-docker notranslate"><div class="highlight"><pre><span></span><span class="c"># Copyright 2019 - 2021 The MathWorks, Inc.</span>

<span class="c"># To specify which MATLAB release to install in the container, edit the value of the MATLAB_RELEASE argument.</span>
<span class="c"># Use lower case to specify the release, for example: ARG MATLAB_RELEASE=r2020a</span>
<span class="hll"><span class="k">ARG</span><span class="w"> </span><span class="nv">MATLAB_RELEASE</span><span class="o">=</span>r2021b
</span>
<span class="c"># When you start the build stage, this Dockerfile by default uses the Ubuntu-based matlab-deps image.</span>
<span class="c"># To check the available matlab-deps images, see: https://hub.docker.com/r/mathworks/matlab-deps</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">mathworks/matlab-deps:${MATLAB_RELEASE}</span>

<span class="c"># Declare the global argument to use at the current build stage</span>
<span class="k">ARG</span><span class="w"> </span>MATLAB_RELEASE

<span class="c"># Install mpm dependencies</span>
<span class="k">RUN</span><span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span>noninteractive<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>apt-get<span class="w"> </span>install<span class="w"> </span>--no-install-recommends<span class="w"> </span>--yes<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>wget<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>unzip<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>ca-certificates<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>apt-get<span class="w"> </span>clean<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>autoremove

<span class="c"># Run mpm to install MATLAB in the target location and delete the mpm installation afterwards</span>
<span class="k">RUN</span><span class="w"> </span>wget<span class="w"> </span>-q<span class="w"> </span>https://www.mathworks.com/mpm/glnxa64/mpm<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\ </span>
<span class="w">    </span>chmod<span class="w"> </span>+x<span class="w"> </span>mpm<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>./mpm<span class="w"> </span>install<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--release<span class="o">=</span><span class="si">${</span><span class="nv">MATLAB_RELEASE</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--destination<span class="o">=</span>/opt/matlab<span class="w"> </span><span class="se">\</span>
<span class="hll"><span class="w">    </span>--products<span class="w"> </span>MATLAB<span class="w"> </span>Parallel_Computing_Toolbox<span class="w"> </span>Mapping_Toolbox<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
</span><span class="w">    </span>rm<span class="w"> </span>-f<span class="w"> </span>mpm<span class="w"> </span>/tmp/mathworks_root.log<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>ln<span class="w"> </span>-s<span class="w"> </span>/opt/matlab/bin/matlab<span class="w"> </span>/usr/local/bin/matlab

<span class="c"># Add &quot;matlab&quot; user and grant sudo permission.</span>
<span class="k">RUN</span><span class="w"> </span>adduser<span class="w"> </span>--shell<span class="w"> </span>/bin/bash<span class="w"> </span>--disabled-password<span class="w"> </span>--gecos<span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span>matlab<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;matlab ALL=(ALL) NOPASSWD: ALL&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/etc/sudoers.d/matlab<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>chmod<span class="w"> </span><span class="m">0440</span><span class="w"> </span>/etc/sudoers.d/matlab

<span class="c"># Set user and work directory</span>
<span class="k">USER</span><span class="w"> </span><span class="s">matlab</span>
<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/home/matlab</span>
<span class="hll"><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;bash&quot;</span><span class="p">]</span>
</span></pre></div>
</div>
<p>To build a Docker image with the name <code class="docutils literal notranslate"><span class="pre">matlab-gitlab</span></code> and the version reference <code class="docutils literal notranslate"><span class="pre">r2021b</span></code>, run the following command in the folder containing the Dockerfile:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span>build<span class="w"> </span>.<span class="w"> </span>-t<span class="w"> </span>matlab-gitlab:r2021b
</pre></div>
</div>
<p>You can verify the presence of the image with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span>images
</pre></div>
</div>
<p>This image is now available locally on the VPS.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can also <a class="reference external" href="https://docs.docker.com/engine/reference/commandline/push/">upload your Docker image to Dockerhub</a> and have it available from there. This removes the need to build the image on the VPS as it can be pulled directly from DockerHub.</p>
</div>
</section>
<section id="step-4-register-the-matlab-runner">
<h3>Step 4. Register the Matlab runner<a class="headerlink" href="#step-4-register-the-matlab-runner" title="Permalink to this headline">#</a></h3>
<p>After deploying the gitlab-runner in step 2, we need to register a new runner for our <code class="docutils literal notranslate"><span class="pre">matlab-gitlab</span></code> image. Run the following command to register your runner and configure it to deploy in a Docker container on your server.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-it<span class="w"> </span>-v<span class="w"> </span>/srv/gitlab-runner/config:/etc/gitlab-runner<span class="w"> </span>gitlab/gitlab-runner<span class="w"> </span>register
</pre></div>
</div>
<p>In response to this command you will be prompted to answer a series of questions. You can find the required gitlab-ci token in your Gitlab repository under <strong>Settings -&gt; CI/CD -&gt; Runners</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-it<span class="w"> </span>-v<span class="w"> </span>/srv/gitlab-runner/config:/etc/gitlab-runner<span class="w"> </span>gitlab/gitlab-runner<span class="w"> </span>register<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--non-interactive<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--url<span class="w"> </span><span class="s2">&quot;https://gitlab.tudelft.nl/&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--registration-token<span class="w"> </span><span class="s2">&quot;REPOSITORY_TOKEN&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--executor<span class="w"> </span><span class="s2">&quot;docker&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--docker-image<span class="w"> </span>matlab-gitlab:r2021b<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--description<span class="w"> </span><span class="s2">&quot;matlab-runner&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--tag-list<span class="w"> </span><span class="s2">&quot;matlab&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--docker-privileged<span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--docker-cap-add<span class="w"> </span><span class="s2">&quot;NET_ADMIN&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--docker-pull-policy<span class="w"> </span><span class="s2">&quot;if-not-present&quot;</span><span class="w"> </span><span class="se">\</span>
</pre></div>
</div>
<p>For the changes to take effect, restart the gitlab-runner with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span>restart<span class="w"> </span>gitlab-runner
</pre></div>
</div>
<p>The runner configurations are stored in <code class="docutils literal notranslate"><span class="pre">/srv/gitlab-runner/config/config.toml</span></code>. If you would like to view or or modify the Matlab runner, run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>nano<span class="w"> </span>/srv/gitlab-runner/config/config.toml
</pre></div>
</div>
<p>After registering the runner, the configuration file should contain:</p>
<div class="toggle docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">concurrent</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">check_interval</span> <span class="o">=</span> <span class="mi">0</span>

<span class="p">[</span><span class="n">session_server</span><span class="p">]</span>
  <span class="n">session_timeout</span> <span class="o">=</span> <span class="mi">1800</span>

<span class="p">[[</span><span class="n">runners</span><span class="p">]]</span>
  <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;matlab-gitlab&quot;</span>
  <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://gitlab.tudelft.nl&quot;</span>
  <span class="n">token</span> <span class="o">=</span> <span class="s2">&quot;&lt;token&gt;&quot;</span>
  <span class="n">executor</span> <span class="o">=</span> <span class="s2">&quot;docker&quot;</span>
  <span class="p">[</span><span class="n">runners</span><span class="o">.</span><span class="n">custom_build_dir</span><span class="p">]</span>
  <span class="p">[</span><span class="n">runners</span><span class="o">.</span><span class="n">cache</span><span class="p">]</span>
    <span class="p">[</span><span class="n">runners</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">s3</span><span class="p">]</span>
    <span class="p">[</span><span class="n">runners</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">gcs</span><span class="p">]</span>
    <span class="p">[</span><span class="n">runners</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">azure</span><span class="p">]</span>
  <span class="p">[</span><span class="n">runners</span><span class="o">.</span><span class="n">docker</span><span class="p">]</span>
    <span class="n">tls_verify</span> <span class="o">=</span> <span class="n">false</span>
    <span class="n">image</span> <span class="o">=</span> <span class="s2">&quot;matlab-gitlab:r2021b&quot;</span>
    <span class="n">privileged</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">disable_entrypoint_overwrite</span> <span class="o">=</span> <span class="n">false</span>
    <span class="n">cap_add</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;NET_ADMIN&quot;</span><span class="p">]</span>
    <span class="n">oom_kill_disable</span> <span class="o">=</span> <span class="n">false</span>
    <span class="n">disable_cache</span> <span class="o">=</span> <span class="n">false</span>
    <span class="n">volumes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;/cache&quot;</span><span class="p">]</span>
    <span class="n">pull_policy</span> <span class="o">=</span> <span class="s2">&quot;if-not-present&quot;</span>
    <span class="n">shm_size</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</section>
<section id="step-5-obtain-a-matlab-license-file">
<h3>Step 5. Obtain a Matlab license file<a class="headerlink" href="#step-5-obtain-a-matlab-license-file" title="Permalink to this headline">#</a></h3>
<p>Every TU Delft employee has access to an Individual Matlab license. Normally, you would activate Matlab only once after installation through an online activation step. However, this does not work for a Docker container as it is relaunched for each CI trigger.</p>
<p>The following steps for activating Matlab on an offline machine are adapted from the <a class="reference external" href="https://nl.mathworks.com/matlabcentral/answers/259627-how-do-i-activate-matlab-or-other-mathworks-products-without-an-internet-connection">Matlab Forum</a>:</p>
<ol class="arabic simple">
<li><p>Obtain your Host ID</p></li>
<li><p>Obtain your computer login name or username</p></li>
<li><p>Activate the license through the License Center to obtain license file</p></li>
</ol>
<p><strong>1. Obtain your Host ID</strong><br />
The Matlab license can only be activated for a specifc computer. In the Docker container, we will set the hostID of the container to <strong>0242ac11ffff</strong>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Docker automatically assigns an IP address to each running container, starting from 172.17.0.2 until 172.17.0.255. These IP addresses determine the container‚Äôs MAC address (see <a class="reference external" href="https://docs.gz.ro/modify-linux-hostid.html">here</a> for more details), which in turn needs to match with our license. To prevent the MAC address of the Matlab container from switching and thereby invalidating the license, we will set it to 02:42:ac:11:ff:ff in the <code class="docutils literal notranslate"><span class="pre">.gitlab-ci.yml</span></code> file.</p>
</div>
<p><strong>2. Obtain your computer login name or username</strong><br />
The Matlab license is created for a specific user. In the Docker container, we will set the username to <strong>matlab</strong>.</p>
<p><strong>3. Activate the license through the License Center to obtain license file</strong></p>
<ol class="arabic simple">
<li><p>Go to the License Center: <a class="reference external" href="https://www.mathworks.com/mwaccount">https://www.mathworks.com/mwaccount</a></p></li>
<li><p>Under My Software, click the license number you want to activate. If you do not see your license number, in the bottom right hand corner, click View Additional Licenses or Trials.</p></li>
<li><p>Click the Install and Activate tab</p></li>
<li><p>Click Activate to Retrieve License File and/or Activate a Computer</p></li>
<li><p>Enter the following information:</p>
<ul class="simple">
<li><p>the release you are activating = <strong>r2021b</strong> (same version as in the Dockerfile)</p></li>
<li><p>the operating system = <strong>Linux</strong></p></li>
<li><p>the host ID = <strong>0242ac11ffff</strong></p></li>
<li><p>your user or login name = <strong>matlab</strong></p></li>
<li><p>the Activation Label = <strong>matlab-gitlab</strong></p></li>
</ul>
</li>
<li><p>Download the <code class="docutils literal notranslate"><span class="pre">license.lic</span></code> file</p></li>
</ol>
</section>
<section id="step-6-configure-the-ci-cd-pipeline-on-gitlab">
<h3>Step 6. Configure the CI/CD pipeline on Gitlab<a class="headerlink" href="#step-6-configure-the-ci-cd-pipeline-on-gitlab" title="Permalink to this headline">#</a></h3>
<p>Before we can run a CI job, we need to configure a few settings in our Gitlab repository</p>
<p><strong>1. Add tag to matlab runner</strong><br />
Under <strong>Settings -&gt; CI/CD -&gt; Runners</strong> we can find the available specific runners. Press the edit button on the matlab-gitlab runner and add the tag <code class="docutils literal notranslate"><span class="pre">matlab-gitlab</span></code>. With this, we can call more easily call this specific runner within our CI pipeline.</p>
<p><strong>2. Add license as Variable</strong><br />
Under <strong>Settings -&gt; CI/CD -&gt; Variables</strong> add a new variable called <code class="docutils literal notranslate"><span class="pre">MATLAB_LICENSE</span></code>, past the content of the downloaded <code class="docutils literal notranslate"><span class="pre">license.lic</span></code> file and set <code class="docutils literal notranslate"><span class="pre">type</span></code> to <code class="docutils literal notranslate"><span class="pre">file</span></code>. Having the license available as a Gitlab variable allows us to update it without having to change the Matlab image.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Alternatively, we could have added the license file directly to the Docker image. With the license file in the same folder as the Dockerfile and adding the following command to the Dockerfile, we can build a Docker image with an activated Matlab:</p>
<div class="highlight-docker notranslate"><div class="highlight"><pre><span></span><span class="k">COPY</span><span class="w"> </span>license.lic<span class="w"> </span>/opt/matlab/licenses/
</pre></div>
</div>
<p>Here, we opted to have it accessible through the Gitlab settings together with the accompanying hostid.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Never share any Docker images that contain license files or other confidential information.</p>
</div>
</div>
</section>
<section id="step-7-add-a-job-to-test-the-pipeline">
<h3>Step 7. Add a job to test the pipeline<a class="headerlink" href="#step-7-add-a-job-to-test-the-pipeline" title="Permalink to this headline">#</a></h3>
<p>To test the pipeline, add the following content to <code class="docutils literal notranslate"><span class="pre">.gitlab-ci.yml</span></code> via <strong>CI/CD -&gt; Editor</strong> in your repository.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">variables</span><span class="p">:</span>
<span class="w">  </span><span class="nt">MAC_ADDRESS</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">02:42:ac:11:ff:ff</span>

<span class="nt">check_matlab</span><span class="p">:</span>
<span class="w">  </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">matlab-gitlab</span>
<span class="w">  </span><span class="nt">before_script</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># Change the mac-address to match the Matlab license</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sudo ifconfig eth0 hw ether &quot;$MAC_ADDRESS&quot;</span>

<span class="w">    </span><span class="c1"># Add the Matlab license to the Matlab installation in the container</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sudo mkdir /opt/matlab/licenses</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sudo mv ${MATLAB_LICENSE} /opt/matlab/licenses/license.lic</span><span class="w">   </span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span><span class="w">    </span>
<span class="w">    </span><span class="c1"># Run a Matlab function/script through the -batch argument</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">matlab -batch &quot;disp(&#39;hello world!&#39;)&quot;</span>
</pre></div>
</div>
<p>After commiting, the pipeline should run and execute the job <code class="docutils literal notranslate"><span class="pre">check_matlab</span></code>. You can check the status of the pipeline via <strong>CI/CD -&gt; Pipelines</strong>.</p>
<p>If all went well, you have successfully setup a Gitlab runner to run Matlab code. Congrats!</p>
</section>
<section id="step-8-optional-updating-the-matlab-version">
<h3>Step 8. Optional: Updating the Matlab version<a class="headerlink" href="#step-8-optional-updating-the-matlab-version" title="Permalink to this headline">#</a></h3>
<p>If you need to update the Matlab version of the Docker container, you will need to go throught the following steps:</p>
<ol class="arabic">
<li><p>Update the Matlab version in the Dockerfile</p></li>
<li><p>Build the docker image with
<code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">build</span> <span class="pre">.</span> <span class="pre">-t</span> <span class="pre">matlab-gitlab:&lt;version&gt;</span></code></p></li>
<li><p>Download a new <code class="docutils literal notranslate"><span class="pre">license.lic</span></code> file (see step 5 of this guide)</p></li>
<li><p>Update the CI Variable <code class="docutils literal notranslate"><span class="pre">MATLAB_LICENSE</span></code> with the new license content</p></li>
<li><p>Update the image names (not the tags) in <code class="docutils literal notranslate"><span class="pre">.gitlab-ci.yml</span></code> to use the new image.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you want to test your code with multiple Matlab versions to ensure backward compatibility, please look at this <a class="reference external" href="https://forum.gitlab.com/t/testing-with-all-version-combinations-of-python-django/7408">example</a> to use multiple docker images.</p>
</div>
</li>
</ol>
</section>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://nl.mathworks.com/matlabcentral/answers/259627-how-do-i-activate-matlab-or-other-mathworks-products-without-an-internet-connection">Activating Matlab without an internet connection</a></p></li>
<li><p><a class="reference external" href="https://docs.gitlab.com/runner/install/docker.html">Run GitLab Runner in a container</a></p></li>
<li><p><a class="reference external" href="https://docs.gitlab.com/runner/register/">Register a Gitlab runner</a></p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./infrastructure/gitlab"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="gitlab_docker.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Continuous Integration with Gitlab</p>
      </div>
    </a>
    <a class="right-next"
       href="../../data/getting_started.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Getting started</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#purpose-of-this-guide">Purpose of this guide</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites">Prerequisites</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#glossary-of-terms">Glossary of terms</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#steps">Steps</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-request-a-tu-delft-vps">Step 1. Request a TU Delft VPS</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-setting-up-gitlab-runners">Step 2. Setting up Gitlab runners</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-create-a-docker-image-containing-a-custom-matlab-installation">Step 3. Create a Docker image containing a custom Matlab installation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-register-the-matlab-runner">Step 4. Register the Matlab runner</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-5-obtain-a-matlab-license-file">Step 5. Obtain a Matlab license file</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-6-configure-the-ci-cd-pipeline-on-gitlab">Step 6. Configure the CI/CD pipeline on Gitlab</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-7-add-a-job-to-test-the-pipeline">Step 7. Add a job to test the pipeline</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-8-optional-updating-the-matlab-version">Step 8. Optional: Updating the Matlab version</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By TU Delft Digital Competence Center
</p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>